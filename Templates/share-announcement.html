{% extends 'layout.html' %}
{% load static %}
{% load i18n %}

{% block title %}
    Dasinmaz.az | Yeni elan paylaş
{% endblock title %}

{% block styles %}
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.9.4/css/bulma.min.css">
{% endblock styles %}

{% block container %}
    <section class="auto-container py-4">
        <div class="sec-title"> 
            <h2>Yeni elan paylaş</h2>
        </div>
        <form action="" method="POST" enctype="multipart/form-data" class="default-form col-lg-6 col-md-12">
            {% csrf_token %}
             
            <!-- Əsas şəkil -->
            <div class="file is-success">
                <label class="file-label">
                    <input class="file-input" type="file" name="announcement_picture" accept="image/*">
                    <span class="file-cta">
                        <span class="file-icon"> <i class="fas fa-upload"></i> </span>
                        <span class="file-label"> Əsas şəkli seçin </span>
                    </span>
                </label>
            </div>
            <br>

            <!-- Elanın növü -->
            <div class="field is-success">
                <label class="label" for="announcement_type_of">Elanın növü</label>
                <div class="control">
                    <label class="radio">
                        <input type="radio" name="announcement_type_of" value="1"> Satış
                    </label>
                    <label class="radio">
                        <input type="radio" name="announcement_type_of" value="2"> Kirayə
                    </label>
                </div>
            </div>

            <!-- Kateqoriya -->
            <div class="field">
                <label class="label" for="announcement_category">Kateqoriya</label>
                <p class="control has-icons-left">
                    <span class="select is-success">
                        <select name="announcement_category" id="announcement_category">
                            {% for category in categories %}
                                <option value="{{category.name}}" {% if category.id == announcement_category_int %}selected{% endif %}> {{category.name}} </option>
                            {% endfor %}
                        </select>
                    </span>
                    <span class="icon is-small is-left"> <i class="fa-solid fa-layer-group"></i> </span>
                </p>
            </div>   

            <!-- Mərtəbə sayı -->
            <div class="field announcement_floor_count">
                <label class="label" for="announcement_floor_count">Mərtəbə sayı</label>
                <div class="control">
                    <input class="input is-success" type="number" placeholder="Mərtəbə sayı" id="announcement_floor_count" name="announcement_floor_count">
                </div>
            </div>

            <!-- Mərtəbə -->
            <div class="field announcement_floor ">
                <label class="label" for="announcement_floor">Mərtəbə</label>
                <div class="control">
                    <input class="input is-success" type="number" placeholder="Mərtəbə" id="announcement_floor" name="announcement_floor">
                </div>
            </div> 

            <!-- Mənzil -->
            <div class="field announcement_apartment">
                <label class="label" for="announcement_apartment">Mənzil nömrəsi</label>
                <div class="control">
                    <input class="input is-success" type="number" placeholder="Mənzil" id="announcement_apartment" name="announcement_apartment">
                </div>
            </div> 

            <!-- Otaq sayı -->
            <div class="field">
                <label class="label" for="announcement_room_count">Otaq sayı</label>
                <div class="control">
                    <input class="input is-success" type="number" placeholder="Otaq sayı" id="announcement_room_count" name="announcement_room_count">
                </div>
            </div> 

            <!-- Valyuta --> 
            <div class="field">
                <label class="label" for="announcement_currency">Valyuta</label>
                <p class="control has-icons-left">
                    <span class="select is-success">
                        <select name="announcement_currency" id="announcement_currency">
                            {% for ch in ch_tuple %} 
                                <option value="{{ch.key}}">{{ch.key}}</option>
                            {% endfor %}
                        </select>
                    </span>
                    <span class="icon is-small is-left"> <i class="fa-solid fa-coins"></i> </span>
                </p>
            </div> 

            <!-- Qiymət sayı -->
            <div class="field">
                <label class="label" for="announcement_price">Qiymət</label>
                <div class="control">
                    <input class="input is-success" type="number" placeholder="Qiymət" id="announcement_price" name="announcement_price">
                </div>
            </div> 

            <!-- İlkin ödəniş -->
            <div class="field announcement_the_initial_payment">
                <label class="label" for="announcement_the_initial_payment">İlkin ödəniş</label>
                <div class="control">
                    <input class="input is-success" type="number" placeholder="İlkin ödəniş" id="announcement_the_initial_payment" name="announcement_the_initial_payment">
                </div>
            </div> 

            <!-- Sahə -->
            <div class="field">
                <label class="label" for="announcement_area">Sahə</label>
                <div class="control">
                    <input class="input is-success" type="number" placeholder="Sahə" id="announcement_area" name="announcement_area">
                </div>
            </div>  

            <!-- Açıqlama -->
            <div class="field">
                <label class="label" for="announcement_description">Açıqlama</label>
                <div class="control">
                  <textarea class="textarea" placeholder="Açıqlama" name="announcement_description" id="announcement_description"></textarea>
                </div>
            </div>

            <div class="columns is-mobile is-multiline">
                <div class="column is-8">
                    <!-- İnternet var -->
                    <div class="field">
                        <div class="control">
                            <label class="checkbox" for="announcement_has_internet">
                                <input type="checkbox" name="announcement_has_internet" id="announcement_has_internet"> İnternet var
                            </label>
                        </div>
                    </div>
                </div>
                <div class="column is-8">
                    <!-- Qaz çəkilib -->
                    <div class="field">
                        <div class="control">
                            <label class="checkbox" for="announcement_has_gas">
                                <input type="checkbox" name="announcement_has_gas" id="announcement_has_gas"> Qaz çəkilib
                            </label>
                        </div>
                    </div>
                </div>
                <div class="column is-8">
                    <!-- Elektriklə təchiz olunub -->
                    <div class="field">
                        <div class="control">
                            <label class="checkbox" for="announcement_has_electricity">
                                <input type="checkbox" name="announcement_has_electricity" id="announcement_has_electricity"> Elektriklə təchiz olunub
                            </label>
                        </div>
                    </div>
                </div>
                <div class="column is-8">
                    <!-- Su çəkilib -->
                    <div class="field">
                        <div class="control">
                            <label class="checkbox" for="announcement_has_water">
                                <input type="checkbox" name="announcement_has_water" id="announcement_has_water"> Su çəkilib
                            </label>
                        </div>
                    </div>
                </div>
                <div class="column is-8">
                    <!-- Əlavə su çəni var -->
                    <div class="field">
                        <div class="control">
                            <label class="checkbox" for="announcement_has_water_tank">
                                <input type="checkbox" name="announcement_has_water_tank" id="announcement_has_water_tank"> Əlavə su çəni var
                            </label>
                        </div>
                    </div>
                </div>
                <div class="column is-8">
                    <!-- Kombi var -->
                    <div class="field">
                        <div class="control">
                            <label class="checkbox" for="announcement_has_combi">
                                <input type="checkbox" name="announcement_has_combi" id="announcement_has_combi"> Kombi var
                            </label>
                        </div>
                    </div>
                </div>
                <div class="column is-8">
                    <!-- Əşyalıdır -->
                    <div class="field">
                        <div class="control">
                            <label class="checkbox" for="announcement_furnished">
                                <input type="checkbox" name="announcement_furnished" id="announcement_furnished"> Əşyalıdır
                            </label>
                        </div>
                    </div>
                </div>
                <div class="column is-8">
                    <!-- Təmirlidir -->
                    <div class="field">
                        <div class="control">
                            <label class="checkbox" for="announcement_renovated">
                                <input type="checkbox" name="announcement_renovated" id="announcement_renovated"> Təmirlidir
                            </label>
                        </div>
                    </div>
                </div>
                <div class="column is-8 announcement_elevator">
                    <!-- Lift var -->
                    <div class="field">
                        <div class="control">
                            <label class="checkbox" for="announcement_elevator">
                                <input type="checkbox" name="announcement_elevator" id="announcement_elevator"> Lift var
                            </label>
                        </div>
                    </div>
                </div>
            </div> 
            

            <!-- Digər şəkillər -->
            <div class="file is-success">
                <label class="file-label">
                    <input class="file-input" type="file" name="announcement_pictures" accept="image/*" multiple id="announcement_pictures">
                    <span class="file-cta">
                        <span class="file-icon"> <i class="fas fa-upload"></i> </span>
                        <span class="file-label"> Digər şəkilləri seçin </span>
                    </span>
                </label>
            </div>

            <!-- İmages box -->
            <div class="images-box"></div> 

            <div class="field">
                <div class="control">
                    <label class="checkbox">
                    <input type="checkbox">
                        <a href="{% url 'rules-page' %}" target="_blank">Qaydalar və Şərtləri</a> qəbul edərək elanın paylaşılmasını istəyirəm.
                    </label>
                </div>
            </div>

            <!-- Button -->
            <button class="button is-success" type="submit">Paylaş</button>
        </form>
    </section>
{% endblock container %}


{% block scripts %} 
    <script>
        let announcement_type_ofs = document.querySelectorAll("input[name=announcement_type_of]")
        announcement_type_ofs.forEach(announcement_type_of=>{
            announcement_type_of.addEventListener("change", function(e){
                if(announcement_type_of.value == "2"){
                    document.querySelector(".announcement_the_initial_payment").style.display = "none"
                } else if(announcement_type_of.value == "1") {
                    document.querySelector(".announcement_the_initial_payment").style.display = "block" 
                }
            })
        })

        let announcement_category = document.getElementById("announcement_category")
        announcement_category.addEventListener("change", function(e){
            if(announcement_category.value == "Mənzil"){
                document.querySelector(".announcement_floor_count").style.display = "none"
                document.querySelector(".announcement_floor").style.display = "block"
                document.querySelector(".announcement_apartment").style.display = "block"
                document.querySelector(".announcement_elevator").style.display = "block"
            } else {
                document.querySelector(".announcement_floor_count").style.display = "block" 
                document.querySelector(".announcement_floor").style.display = "none"
                document.querySelector(".announcement_apartment").style.display = "none"
                document.querySelector(".announcement_elevator").style.display = "none" 
            }   
        })
     
        let announcement_pictures_input = document.getElementById("announcement_pictures")
        let images_box = document.querySelector(".images-box")
        images_box.innerHTML = ""

        announcement_pictures_input.addEventListener("change", async function(e){
            let images = announcement_pictures_input.files;
            
            for (let index = 0; index < images.length; index++) {
                const img_file = images[index];
                await addImage(img_file);
            }
    
        })

        async function addImage(img_file) {
            return new Promise((resolve, reject) => {
                var reader = new FileReader(); 
                reader.onload = function (event) { 
                    let img = document.createElement("img");
                    img.setAttribute("src", reader.result);
                    img.setAttribute("draggable", false)
                    let figure = document.createElement("figure");
                    figure.appendChild(img);
                    images_box.appendChild(figure); 
                    resolve();
                }; 
                reader.readAsDataURL(img_file);
            });
        }
    </script>
{% endblock scripts %}
 